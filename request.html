<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LYNQUP | Finalize Request</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #fff; color: #1d1d1f; }
        .input-field { width: 100%; padding: 1.2rem; background: #f5f5f7; border-radius: 14px; border: none; outline: none; transition: 0.3s; }
        .input-field:focus { background: #e8e8ed; }
        .talent-strip { border-bottom: 1px solid #f5f5f7; padding: 1.5rem 0; }
    </style>
</head>
<body class="pb-20">

    <nav class="h-16 border-b border-gray-100 flex items-center px-6 justify-between sticky top-0 bg-white z-50">
        <div class="text-xl font-semibold tracking-tighter uppercase">LYNQUP</div>
        <a href="index.html" class="text-sm font-medium text-blue-600">Back to Store</a>
    </nav>

    <main class="max-w-6xl mx-auto px-6 pt-20">
        <h1 class="text-5xl font-semibold mb-12 tracking-tight">Review your Request.</h1>

        <div class="grid lg:grid-cols-3 gap-16">
            <div class="lg:col-span-2">
                <h2 class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-6">Execution Roster</h2>
                <div id="talent-list" class="mb-20"></div>
                
                <h2 class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-8">Event Brief</h2>
                <div class="space-y-6">
                    <input type="text" id="event_name" class="input-field" placeholder="Event Title (e.g. Sunburn 2025)">
                    <div class="grid md:grid-cols-2 gap-6">
                        <input type="date" id="event_date" class="input-field">
                        <input type="text" id="event_loc" class="input-field" placeholder="Location">
                    </div>
                    <textarea id="event_brief" rows="4" class="input-field" placeholder="Describe the execution goals and deliverables..."></textarea>
                </div>
            </div>

            <div class="sticky top-28 bg-[#f5f5f7] p-8 rounded-[2.5rem] h-fit">
                <h3 class="text-xl font-semibold mb-6">Summary</h3>
                <div class="flex justify-between mb-4 text-sm"><span class="text-gray-500">Selected Talent</span><span id="summary-count" class="font-bold">0</span></div>
                <div class="flex justify-between mb-8 text-sm"><span class="text-gray-500">Management</span><span class="text-gray-400">LYNQUP Verified</span></div>
                <button id="send-btn" onclick="submitRequest()" class="w-full py-5 bg-black text-white rounded-full font-bold text-lg hover:opacity-80 transition">Send Unified Request</button>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const SB_URL = "https://pljjbfzhdalaqkzvmrwr.supabase.co";
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBsampiZnpoZGFsYXFrenZtcndyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY5NTY2MzIsImV4cCI6MjA4MjUzMjYzMn0.sGik1UlAT-wg_q9HpFuMXRhxycR1wIX7zpdFwZg8DkI";
        const lynqup = window.supabase.createClient(SB_URL, SB_KEY);

        let bag = JSON.parse(localStorage.getItem('lynqup_bag')) || [];

        function render() {
            const list = document.getElementById('talent-list');
            document.getElementById('summary-count').innerText = bag.length;
            if (bag.length === 0) { list.innerHTML = '<p class="text-gray-400 italic">Add talent from the store to begin.</p>'; return; }
            list.innerHTML = bag.map((item, i) => `
                <div class="talent-strip flex items-center justify-between">
                    <div class="flex items-center gap-6"><img src="${item.img}" class="w-16 h-16 rounded-2xl object-cover"><div><p class="font-semibold text-lg">${item.name}</p><p class="text-gray-400 text-sm">${item.role}</p></div></div>
                    <button onclick="remove(${i})" class="text-red-500 text-xs font-bold uppercase">Remove</button>
                </div>`).join('');
        }

        function remove(i) { bag.splice(i, 1); localStorage.setItem('lynqup_bag', JSON.stringify(bag)); render(); }

        async function submitRequest() {
            const btn = document.getElementById('send-btn');
            const data = { event_name: document.getElementById('event_name').value, event_date: document.getElementById('event_date').value, location: document.getElementById('event_loc').value, brief: document.getElementById('event_brief').value, talent_names: bag.map(t=>t.name).join(', '), status: 'pending' };
            if(!data.event_name || bag.length === 0) return alert("Please fill the brief and add at least one creator.");
            btn.innerText = "Initializing Engine...";
            const { error } = await lynqup.from('event_requests').insert([data]);
            if (error) alert(error.message);
            else { alert("Unified Request Sent to LYNQUP Engine!"); localStorage.removeItem('lynqup_bag'); window.location.href="index.html"; }
        }
        window.onload = render;
    </script>
</body>
</html>